# Testing LoRA on different light and electron miscroscopy datasets

### Datasets
**gonuclear**: Dataset for nuclei segmentation in 3D fluorescence microscopy (lm)
**orgasegment**: Dataset for the segmentation of human intestinal organoids (lm)  
**covid_if**: Datset that contains annotation for cell and nucleus segmentation in immunofluorescence microscopy(lm)  
**mitolab/glycolytic_muscle**: Dataset for mitochondria segmentation (em)  
**platynereis/cilia**: Dataset for the segmentation of cilia in the platynereis larve. 

## Comparing LoRA with Full Finetuning
On all 5 datasets the SAM model is trained from default and from the micro-sam models using LoRA and full finetuning.  
Note that all datasets except GuNuclear are trained with early stopping while GoNuclear is trained for 50k iterations.

### Orgasegment

|                    |        ais |      amg |   single box |   single point |   iterative_prompts_start_box |   iterative_prompts_start_point |
|:-------------------|-----------:|---------:|-------------:|---------------:|------------------------------:|--------------------------------:|
| generalist         |   0.239504 | 0.313557 |     0.766814 |       0.426106 |                      0.870109 |                        0.813314 |
| specialist_full_ft |   0.51541  | 0.423463 |     0.790572 |       0.556546 |                      0.87495  |                        0.841196 |
| specialist_lora    |   0.478586 | 0.372293 |     0.77696  |       0.510568 |                      0.872069 |                        0.839907 |
| vanilla            | -| 0.343003 |     0.630294 |       0.494892 |                      0.484599 |                        0.475463 |

### Platynereis Cilia


|                    |        ais |        amg |   single box |   single point |   iterative_prompts_start_box |   iterative_prompts_start_point |
|:-------------------|-----------:|-----------:|-------------:|---------------:|------------------------------:|--------------------------------:|
| generalist         |   0        | 0.00875561 |     0.184394 |      0.0593038 |                      0.429399 |                        0.349337 |
| specialist_full_ft |   0.236222 | 0.208035   |     0.371877 |      0.234535  |                      0.524445 |                        0.451413 |
| specialist_lora    |   0.212794 | 0.137063   |     0.369033 |      0.244724  |                      0.51684  |                        0.446328 |
| vanilla            | -| 0.135574   |     0.26555  |      0.175185  |                      0.195464 |                        0.107775 |


### Mitolab Glycolytic Muscle
|                    |        ais |      amg |   single box |   single point |   iterative_prompts_start_box |   iterative_prompts_start_point |
|:-------------------|-----------:|---------:|-------------:|---------------:|------------------------------:|--------------------------------:|
| generalist         |   0.430989 | 0.357421 |     0.791705 |       0.519416 |                      0.931755 |                        0.902345 |
| specialist_full_ft |   0.616114 | 0.552763 |     0.856562 |       0.665076 |                      0.966356 |                        0.946224 |
| specialist_lora    |   0.658877 | 0.53201  |   0.865823|       0.714701 |                    0.9657445       |                        0.945478 |
| vanilla            | -        | 0.150659 |     0.652191 |       0.538324 |                      0.660341 |                        0.56703  |


### CovidIF

|                    |        ais |       amg |   single box |   single point |   iterative_prompts_start_box |   iterative_prompts_start_point |
|:-------------------|-----------:|----------:|-------------:|---------------:|------------------------------:|--------------------------------:|
| generalist         |   0.152222 | 0.0746765 |     0.569341 |      0.156363  |                      0.81381  |                       0.721318  |
| specialist_full_ft |   0.244846 | 0.13918   |     0.619487 |      0.244443  |                      0.825262 |                       0.749033  |
| specialist_lora    |   0.196347 | 0.0357408 |     0.583991 |      0.180315  |                      0.817916 |                       0.725224  |
| vanilla            | - | 0.0529358 |     0.388909 |      0.0424461 |                      0.29122  |                       0.0958208 |



# GoNuclear 

|                    |        ais |       amg |   single box |   single point |   iterative_prompts_start_box |   iterative_prompts_start_point |
|:-------------------|-----------:|----------:|-------------:|---------------:|------------------------------:|--------------------------------:|
| generalist         |    0.0890959 | 0.033125|    0.686063 |      0.167951|                      0.764031  |                       0.686301  |
| specialist_full_ft |   0.105786 | 0.030567   |    0.719985 |      0.244551  |                      0.744716 |                       0.653932  |
| specialist_lora    |   0.204244 |  0.043957 |     0.673355 |     0.268546 |                      0.756035 |                       0.684994  |
| vanilla            | - | -|     0.498223|      0.362247|                      0.439616|                       0.318307 |


## Extended Rank Study on Mitolab Glycolytic Muscle
### Mitolab Glycolytic Muscle

Domain is well known by the generalist model

#### From Default
| name    |      AIS |      AMG |      Box |    Point |
|:--------|---------:|---------:|---------:|---------:|
| vanilla | nan        | 0.150659 | 0.652191 | 0.538324 |
| lora_1  | 0.549484 | 0.507444 | 0.841889 | 0.711415 |
| lora_2  | 0.556883 | 0.490352 | 0.845439 | 0.706573 |
| lora_4  | 0.591906 | 0.489366 | 0.848887 | 0.702615 |
| lora_8  | 0.600346 | 0.476347 | 0.848355 | 0.693523 |
| lora_16 | 0.583292 | 0.471583 | 0.848447 | 0.709279 |
| lora_32 | 0.577014 | 0.505774 | 0.847235 | 0.696355 |
| lora_64 | 0.594854 | 0.531694 | 0.847471 | 0.733067 |
| full_ft | 0.654125 | 0.58816  | 0.844841 | 0.670931 |

#### From Generalist

| name    |      AIS |      AMG |      Box |    Point |
|:--------|---------:|---------:|---------:|---------:|
| generalist | 0.430989 | 0.357421 | 0.791705 | 0.519416 |
| lora_1  | 0.617624 | 0.539184 | 0.86804  | 0.727741 |
| lora_2  | 0.636927 | 0.531309 | 0.866054 | 0.72443  |
| lora_4  | 0.612037 | 0.555217 | 0.865789 | 0.722931 |
| lora_8  | 0.648352 | 0.564039 | 0.863956 | 0.730869 |
| lora_16 | 0.626368 | 0.559474 | 0.865566 | 0.727721 |
| lora_32 | 0.630273 | 0.562193 | 0.865755 | 0.72731  |
| lora_64 | 0.615694 | 0.572311 | 0.865311 | 0.742754 |
| full_ft | 0.681277 | 0.58494  | 0.854074 | 0.688395 |

### Orgasegment

Domain is highly different from domain ‘known’ by the generalist model

#### From Default
| name    |      AIS |      AMG |      Box |    Point |
|:--------|---------:|---------:|---------:|---------:|
| vanilla | nan        | 0.343003 | 0.630294 | 0.494892 |
| lora_1  | 0.414372 | 0.370126 | 0.767285 | 0.531497 |
| lora_2  | 0.426449 | 0.373112 | 0.770356 | 0.540227 |
| lora_4  | 0.429695 | 0.372823 | 0.76679  | 0.536833 |
| lora_8  | 0.418091 | 0.373189 | 0.769579 | 0.551802 |
| lora_16 | 0.419071 | 0.377984 | 0.773225 | 0.559315 |
| lora_32 | 0.421673 | 0.392801 | 0.77536  | 0.56451  |
| lora_64 | 0.431376 | 0.392141 | 0.77401  | 0.581975 |
| full_ft | 0.481982 | 0.450553 | 0.753868 | 0.568104 |


#### From Generalist

| name    |      AIS |      AMG |      Box |    Point |
|:--------|---------:|---------:|---------:|---------:|
| generalist | 0.239504 | 0.313557 | 0.766814 | 0.426106 |
| lora_1  | 0.467328 | 0.384649 | 0.788527 | 0.526489 |
| lora_2  | 0.471765 | 0.39285  | 0.792983 | 0.536056 |
| lora_4  | 0.455499 | 0.393884 | 0.796325 | 0.536955 |
| lora_8  | 0.451356 | 0.394755 | 0.795676 | 0.537157 |
| lora_16 | 0.476082 | 0.409496 | 0.787012 | 0.534475 |
| lora_32 | 0.471721 | 0.402015 | 0.794801 | 0.550029 |
| lora_64 | 0.474701 | 0.400378 | 0.798804 | 0.555428 |
| full_ft    | 0.504257 | 0.428629 | 0.77399  | 0.56243  |


## LoRA Scaling Factor study on LIVECell

Grid-Search on $\alpha , r \in [1, 2, 4, 8, 16, 32, 64]$ with ratio within [0.25, 8]
| $\alpha$ | $r$ | Ratio ($\alpha / r $) |     ais     |   single box   |   single point   | iterative_prompts_start_box | iterative_prompts_start_point |
|:--------:|:---:|:---------------------:|:-----------:|:--------------:|:----------------:|:---------------------------:|:-----------------------------:|
|    1     |  1  |           1           |  0.395807   |    0.615486    |      0.325721    |           0.804661         |           0.750683           |
|    1     |  2  |         0.5           |  0.389637   |       0.615844        |      0.325124    |              0.806115              |           0.760010           |
|    1     |  4  |         0.25          |  0.395916   |       0.612913        |      0.319702    |              0.802269              |           0.759263           |
|    2     |  1  |           2           |  0.392165   |       0.617992       |      0.311999    |              0.810508             |           0.760272           |
|    2     |  2  |           1           |  0.396240   |       0.618162       |          0.323697       |              0.809942              |               0.759084             |
|    2     |  4  |         0.5           |  0.392891   |       0.615925        |      0.322978    |              0.807443              |           0.762258           |
|    2     |  8  |         0.25          |  0.393931   |       0.613252        |      0.315850    |              0.806363              |           0.759939           |
|    4     |  1  |           4           |  0.394343   |       0.613421       |      0.323378    |              0.796296              |           0.739636           |
|    4     |  2  |           2           |  0.395642   |       0.617249        |          0.328365       |              0.805607              |               0.756840              |
|    4     |  4  |           1           | **0.397209** |       0.615531        |      0.323281    |              0.804482             |           0.763157           |
|    4     |  8  |         0.5           |  0.391641   |       0.6144223        |      0.324480    |              0.805830              |           0.753668           |
|    8     |  2  |           4           |  0.396141   |       0.614827        |      0.314724    |              0.804398              |           0.760238           |
|    8     |  4  |           2           |  0.394748   |       0.615699        |      0.329198    |              0.804913              |           0.759280           |
|    8     |  8  |           1           |  0.392926   |    0.618693    |          0.315886       |           0.810534         |               0.762898              |
|   16     |  2  |           8           | 0.393683 |    0.617609    |          0.319744       |           0.808339         |               0.761741             |
|   16     |  4  |           4           | **0.397685** |    0.612060    |          0.324873       |           0.803977         |               0.758423              |
|   16     |  8  |           2           |  0.392153   |       0.613068        |      0.309891    |              0.797537              |           0.744200           |
|   16     | 16  |           1           |  0.388047   |    0.609197    |          0.317950       |           0.796960         |               0.749713              |
|   16     | 32  |           0.5           |  0.388334   |    0.613198    |          0.317615       |           0.803437         |               0.758490              |
|   16     | 64  |           0.25           |  0.397055   |    0.616314    |          0.318261       |           0.807479         |               0.763853              |
|   32     |  4  |           8           |  0.395519   |    0.615250    |      0.327982    |           0.807934         |           0.764921           |
|   32     |  8  |           4           |  0.395654   |    0.616085    |      0.320207    |           0.807549         |           0.756795           |
|   32     | 16  |           2           |  0.387483   |    0.610370    |          -       |           0.802246         |               -              |
|   32     | 32  |           1           | **0.397351** |    0.615492    |      0.324578    |           0.805679         |           0.759660           |
|   32     | 64  |           0.5           | 0.393369 |    -    |      -    |           -         |           -           |
|   64     |  8  |           8           |  0.395667   |    0.618078    |      0.331249    |           0.809910         |           0.760305           |
|   64     | 16  |           4           |  0.386835   |       -        |          -       |              -              |               -              |
|   64     | 32  |           2           |  0.390477   |       -        |      0.323396    |              -              |           0.755243           |
|   64     | 64  |           1           |  0.392746   |    0.610687    |      0.309833    |           0.795832         |           0.747857           |

